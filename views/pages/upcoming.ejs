<%- include('../partials/header') %>

<div class="upcoming-container">
  <div class="upcoming-header">
    <h2>Upcoming Tasks</h2>
    <a href="/todos/create" class="btn primary">
      <i class="fas fa-plus"></i> Create New Todo
    </a>
  </div>
  
  <% if (todos.length === 0) { %>
    <div class="no-todos">
      <p>You don't have any upcoming tasks.</p>
      <a href="/todos/create" class="btn secondary">Create Your First Todo</a>
    </div>
  <% } else { %>
    <div class="upcoming-list">
      <% 
      // Group todos by date
      const todosByDate = {};
      todos.forEach(todo => {
        const dateStr = todo.date.toDateString();
        if (!todosByDate[dateStr]) {
          todosByDate[dateStr] = [];
        }
        todosByDate[dateStr].push(todo);
      });
      
      // Display todos grouped by date
      Object.keys(todosByDate).sort((a, b) => new Date(a) - new Date(b)).forEach(dateStr => {
        const dateTodos = todosByDate[dateStr];
      %>
        <div class="date-group">
          <h3 class="date-header"><%= dateStr %></h3>
          <div class="date-todos">
            <% dateTodos.forEach(todo => { %>
              <div class="todo-card <%= todo.completed ? 'completed' : '' %>">
                <div class="todo-card-header">
                  <h4 class="todo-title"><%= todo.title %></h4>
                  <span class="todo-time"><%= todo.time %></span>
                </div>
                <% if (todo.description) { %>
                  <p class="todo-description"><%= todo.description %></p>
                <% } %>
                <div class="todo-card-actions">
                  <form action="/todos/toggle/<%= todo._id %>" method="POST" class="inline-form">
                    <button type="submit" class="action-btn toggle-btn">
                      <i class="fas <%= todo.completed ? 'fa-check-circle' : 'fa-circle' %>"></i>
                      <%= todo.completed ? 'Completed' : 'Mark Complete' %>
                    </button>
                  </form>
                  <a href="/todos/edit/<%= todo._id %>" class="action-btn edit-btn">
                    <i class="fas fa-edit"></i> Edit
                  </a>
                  <form action="/todos/delete/<%= todo._id %>" method="POST" class="inline-form delete-form">
                    <button type="submit" class="action-btn delete-btn">
                      <i class="fas fa-trash"></i> Delete
                    </button>
                  </form>
                </div>
              </div>
            <% }); %>
          </div>
        </div>
      <% }); %>
    </div>
  <% } %>
</div>

<script>
  // Confirm before deleting a todo
  document.querySelectorAll('.delete-form').forEach(form => {
    form.addEventListener('submit', function(e) {
      if (!confirm('Are you sure you want to delete this todo?')) {
        e.preventDefault();
      }
    });
  });
</script>

<%- include('../partials/footer') %>
